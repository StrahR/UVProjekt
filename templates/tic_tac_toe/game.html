{% extends '../common/base.html' %}
{% load static %}


{% block head %}
<link rel="stylesheet" type="text/css" href="{% static 'css/tic_tac_toe/style.css' %}">
{% endblock head %}


{% block title %} TTT Game {{ game.pk }} {% endblock title %}


{% block content %}
<div class="container">
{% include 'tic_tac_toe/board.html' %}
{% if game.game_over and game.keep_score %}
    {% if game.winner == 0 %} The game was a tie. {% endif %}
    {% if game.winner == 1 %} Player 1 won. {% endif %}
    {% if game.winner == 2 %} Player 2 won. {% endif %}

    <br><a href="{% url 'ttt:index' %}">Return</a>
{% endif %}
</div>
{% endblock content %}


{% block script %}
<script>
    let gamePK = {{ game.pk }};

    let gameSocket = new WebSocket(
        'ws://' + window.location.host +
        '/ws/ttt/game/' + gamePK + '/');

    gameSocket.onmessage = function(e) {
        let data = JSON.parse(e.data);
        let player = data['player'];
        let i = data['i'];
        let j = data['j'];
        console.log("receive(" + i + "," + j + ") => " + player);
    };

    gameSocket.onclose = function(e) {
        console.error('Chat socket closed unexpectedly');
    };

    sendToSocket = function(i, j) {
        console.log("send(" + i + "," + j + ") => {{ game.player }}");
        gameSocket.send(JSON.stringify({
            'player': {{ game.player }},
            'i': i,
            'j': j,
        }));
    };
</script>
{% endblock script %}
